# üêò PostgreSQL –¥–ª—è ML Pipeline
# –ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è PostgreSQL –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Airflow
FROM postgres:13

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
RUN apt-get update && apt-get install -y \
    postgresql-contrib \
    postgresql-13-postgis-3 \
    curl \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
COPY docker/init-postgres.sh /docker-entrypoint-initdb.d/
COPY docker/postgresql.conf /etc/postgresql/postgresql.conf

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤
RUN chmod +x /docker-entrypoint-initdb.d/init-postgres.sh

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV POSTGRES_DB=airflow
ENV POSTGRES_USER=airflow
ENV POSTGRES_PASSWORD=airflow
ENV POSTGRES_INITDB_ARGS="--encoding=UTF-8 --lc-collate=C --lc-ctype=C"

# –ü–æ—Ä—Ç
EXPOSE 5432

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∫–∏ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
LABEL ml-pipeline.component="postgresql"
LABEL ml-pipeline.version="1.0"
