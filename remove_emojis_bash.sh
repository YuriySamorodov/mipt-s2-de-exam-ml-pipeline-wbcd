#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —ç–º–æ–¥–∑–∏ –∏–∑ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

echo " –ù–∞—á–∏–Ω–∞–µ–º –æ—á–∏—Å—Ç–∫—É —ç–º–æ–¥–∑–∏ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞..."

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–º–æ–¥–∑–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
EMOJIS=(
    "" "" "" "" "" "" "" "" "" "" "" ""
    "" "" "" "" "" "" "" "" "" "" "" ""
    "" "" "" "" "" "" "" "" "" "" "" ""
    "" "" "" "" "" "" "" "" "" "" "üîå" "üóÑÔ∏è"
    "" "" "" "" "üìØ" "üìç" "üìá" "üéñÔ∏è" "üé∫" "üì≤"
    "üîî" "üîï" "üì¢" "üì£" "üîñ" "üè∑Ô∏è" "üìÆ" "üó≥Ô∏è" "‚úèÔ∏è" "‚úíÔ∏è"
    "üñãÔ∏è" "üñäÔ∏è" "üñåÔ∏è" "üñçÔ∏è" "üìí" "üìì" "üìî" "üìï" "üìó" "üìò" "üìô"
    "üìö" "üì∞" "üóûÔ∏è" "üìÉ" "üìú" "" "üìâ" "üóíÔ∏è" "üóìÔ∏è"
    "üìÜ" "üóëÔ∏è" "üìé" "üñáÔ∏è" "üìê" "üìè" "üóÉ" "üóÑ" "üóÇ" "üóë"
    "üîì" "üîè" "üîê" "üë®‚Äç" ""
)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
backup_file() {
    local file="$1"
    cp "$file" "$file.backup.$(date +%Y%m%d_%H%M%S)"
    echo "   –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: $file.backup.$(date +%Y%m%d_%H%M%S)"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ –∏–∑ —Ñ–∞–π–ª–∞
clean_emojis_from_file() {
    local file="$1"
    local changed=false
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç–º–æ–¥–∑–∏ –≤ —Ñ–∞–π–ª–µ
    for emoji in "${EMOJIS[@]}"; do
        if grep -q "$emoji" "$file" 2>/dev/null; then
            changed=true
            break
        fi
    done
    
    if [ "$changed" = true ]; then
        echo " –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º: $file"
        
        # –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        backup_file "$file"
        
        # –£–¥–∞–ª—è–µ–º –∫–∞–∂–¥—ã–π —ç–º–æ–¥–∑–∏
        for emoji in "${EMOJIS[@]}"; do
            sed -i '' "s/$emoji//g" "$file"
        done
        
        # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        sed -i '' 's/  \+/ /g' "$file"  # –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
        sed -i '' 's/^ \+//g' "$file"   # –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫
        
        echo "   –§–∞–π–ª –æ—á–∏—â–µ–Ω"
        return 0
    fi
    
    return 1
}

# –°—á–µ—Ç—á–∏–∫–∏
total_files=0
processed_files=0

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (–∏—Å–∫–ª—é—á–∞–µ–º —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∏ –±—ç–∫–∞–ø—ã)
echo " –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ —Å —ç–º–æ–¥–∑–∏..."

find . -type f \( -name "*.py" -o -name "*.sh" -o -name "*.md" -o -name "*.txt" -o -name "*.cfg" -o -name "*.yaml" -o -name "*.yml" -o -name "*.log" \) \
    ! -name "remove_emojis_bash.sh" \
    ! -name "*.backup.*" \
    ! -path "./venv/*" \
    ! -path "./.git/*" \
    ! -path "./__pycache__/*" \
    ! -path "./node_modules/*" \
    | while read -r file; do
    
    total_files=$((total_files + 1))
    
    if clean_emojis_from_file "$file"; then
        processed_files=$((processed_files + 1))
    fi
done

echo ""
echo " –û–ß–ò–°–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
echo " –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "   –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: $total_files"
echo "   –§–∞–π–ª–æ–≤ —Å —ç–º–æ–¥–∑–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: $processed_files"
echo ""
echo " –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .backup.YYYYMMDD_HHMMSS"
echo "üóëÔ∏è  –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: find . -name '*.backup.*' -delete"
